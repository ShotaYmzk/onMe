# onMe

**旅行・グループでの立替・割り勘・貸し借り管理アプリ**

onMeは、旅行や友人グループで発生する支出の立替・割り勘・貸し借りを簡単に管理し、「誰が誰にいくら返せば良いか」を自動で計算するモダンなiOSアプリです。リアルタイム為替レート対応で、海外旅行でも安心してご利用いただけます。

<div align="center">

[![Swift](https://img.shields.io/badge/Swift-5.9+-orange.svg)](https://swift.org)
[![iOS](https://img.shields.io/badge/iOS-17.0+-blue.svg)](https://developer.apple.com/ios/)
[![SwiftUI](https://img.shields.io/badge/SwiftUI-5.0+-green.svg)](https://developer.apple.com/xcode/swiftui/)
[![Architecture](https://img.shields.io/badge/Architecture-MVVM%20%2B%20Clean-purple.svg)](#アーキテクチャ)

</div>

## ✨ 主な機能

### 🎯 コア機能
- **グループ管理**: 旅行やイベントごとにグループを作成・管理
- **支出記録**: 詳細な支出情報の登録（カテゴリ、参加者、支払者）
- **レシートOCR**: カメラで撮影したレシートから金額を自動抽出
- **自動清算計算**: 最適な返済ルートを自動提案（最小取引回数アルゴリズム）
- **リアルタイム多通貨対応**: 10種類以上の通貨 + リアルタイム為替レート変換

### 💱 通貨・為替機能
- **リアルタイム為替レート**: 1時間ごとに自動更新される最新の為替レート
- **自動通貨変換**: 異なる通貨の支出を設定通貨に自動変換表示
- **オフライン対応**: ネットワークが利用できない場合のフォールバック機能
- **対応通貨**: JPY, USD, EUR, GBP, KRW, CNY, THB, SGD, HKD, AUD

### 🎨 ユーザーエクスペリエンス
- **モダンUI**: SwiftUIベースの直感的で美しいインターフェース
- **ダークモード**: システム設定に連動した外観切り替え
- **アクセシビリティ**: VoiceOverなどの支援技術に完全対応
- **国際化**: 日本語・英語対応
- **パフォーマンス最適化**: 高速起動とスムーズな動作

### 🔒 セキュリティ・プライバシー
- **ローカルストレージ**: すべてのデータはデバイス内に安全に保存
- **データ暗号化**: AES-256による強力な暗号化
- **生体認証**: Face ID/Touch IDによるアプリロック（オプション）
- **プライバシー重視**: 個人情報の最小限収集、外部送信なし

## 🏗 技術仕様

### アーキテクチャ
- **設計パターン**: MVVM + Clean Architecture
- **UI フレームワーク**: SwiftUI
- **データ永続化**: Core Data
- **言語**: Swift 5.9+
- **最小対応OS**: iOS 17.0+
- **リアクティブプログラミング**: Combine

### 主要ライブラリ・フレームワーク
- **Vision**: レシートOCR処理
- **CryptoKit**: データ暗号化
- **LocalAuthentication**: 生体認証
- **Combine**: リアクティブプログラミング
- **PhotosUI**: 画像選択
- **Foundation**: ネットワーク通信（URLSession）

## 📁 プロジェクト構造

```
onMe/
├── Core/
│   ├── Data/                    # Core Data関連
│   │   ├── PersistenceController.swift
│   │   └── TravelSettle.xcdatamodeld
│   └── State/                   # アプリ状態管理
│       └── AppState.swift
├── Domain/
│   ├── Entities/                # ビジネスエンティティ
│   │   ├── ExpenseEntity.swift
│   │   ├── GroupEntity.swift
│   │   └── SettlementEntity.swift
│   └── UseCases/                # ビジネスロジック
│       ├── SettlementCalculationUseCase.swift
│       └── CurrencyConverterUseCase.swift
├── Infrastructure/
│   ├── Currency/                # 通貨・為替レート処理
│   │   └── ExchangeRateService.swift
│   ├── OCR/                     # OCR処理
│   │   └── ReceiptOCRService.swift
│   ├── Performance/             # パフォーマンス監視
│   │   ├── ImageCache.swift
│   │   └── PerformanceMonitor.swift
│   └── Security/                # セキュリティ機能
│       └── DataEncryption.swift
├── Presentation/
│   ├── Views/                   # SwiftUI画面
│   │   ├── Components/          # 共通コンポーネント
│   │   │   └── CurrencyConversionView.swift
│   │   ├── Camera/
│   │   ├── Expenses/
│   │   ├── Groups/
│   │   ├── Settings/
│   │   └── Settlements/
│   └── ViewModels/              # ViewModel
│       ├── GroupListViewModel.swift
│       └── SettlementViewModel.swift
└── Resources/
    └── Localizable.strings      # 国際化リソース
```

## 💱 為替レート機能の詳細

### API統合
- **プライマリAPI**: ExchangeRate-API（無料版）
- **更新頻度**: 1時間ごと（キャッシュ機能付き）
- **フォールバック**: オフライン時の静的レート対応

### 通貨変換の仕組み
1. **リアルタイム取得**: アプリ起動時と通貨変更時に最新レートを取得
2. **自動変換**: 支出入力時に設定通貨への変換金額を表示
3. **キャッシュ管理**: ネットワーク負荷軽減のため1時間キャッシュ
4. **エラーハンドリング**: API障害時の適切なフォールバック

### 対応通貨一覧
| 通貨コード | 通貨名 | シンボル | 地域 |
|-----------|--------|----------|------|
| JPY | 日本円 | ¥ | 日本 |
| USD | 米ドル | $ | アメリカ |
| EUR | ユーロ | € | ヨーロッパ |
| GBP | 英ポンド | £ | イギリス |
| KRW | 韓国ウォン | ₩ | 韓国 |
| CNY | 中国元 | ¥ | 中国 |
| THB | タイバーツ | ฿ | タイ |
| SGD | シンガポールドル | S$ | シンガポール |
| HKD | 香港ドル | HK$ | 香港 |
| AUD | 豪ドル | A$ | オーストラリア |

## 🎯 主要画面

### 1. グループ一覧画面
- 作成したグループの一覧表示
- 各グループの支出合計と予算進捗（設定通貨で表示）
- 新規グループ作成
- 通貨変換済み金額の表示

### 2. 支出登録画面
- 支出詳細の入力（金額、カテゴリ、説明）
- 通貨選択と自動変換プレビュー
- 参加者と支払者の選択
- レシートOCRによる自動入力
- 均等割りまたは個別負担額設定

### 3. 清算画面
- メンバーごとの残高表示（設定通貨）
- リアルタイム通貨変換表示
- 最適な返済提案の自動生成
- 返済履歴の管理
- 清算完了の記録

### 4. 設定画面
- デフォルト通貨設定
- リアルタイム為替レート表示・更新
- 最終更新時刻の確認
- 主要通貨ペアの現在レート表示
- ダークモード切り替え
- 通知設定
- データエクスポート

## 🧮 清算アルゴリズム

onMeは独自の清算アルゴリズムを使用して、グループ内での最小限の取引回数で全員の債務を清算する最適なルートを提案します。

### アルゴリズムの特徴
1. **最小取引回数**: 可能な限り少ない回数の返済で清算
2. **公平性**: 各メンバーの実際の負担額に基づいた正確な計算
3. **効率性**: 大規模グループでも高速計算
4. **多通貨対応**: 異なる通貨の支出も統一通貨で計算

### 計算例（多通貨対応）
```
支出記録:
- メンバーA: $100 (USD) 支払い → ¥15,000相当
- メンバーB: €50 (EUR) 支払い → ¥8,000相当  
- メンバーC: 支払いなし

3人で均等割りの場合:
各人負担額: ¥7,667
メンバーA: +¥7,333 (受け取る)
メンバーB: +¥333 (受け取る)  
メンバーC: -¥7,667 (支払う)

提案される清算:
C → A: ¥7,333
C → B: ¥333
```

## 🔧 開発・ビルド

### 必要環境
- **Xcode**: 15.0+
- **iOS**: 17.0+ Simulator/Device
- **Swift**: 5.9+
- **macOS**: 13.0+ (開発用)

### ビルド手順
1. **プロジェクトをクローン**
```bash
git clone https://github.com/your-username/onMe.git
cd onMe
```

2. **Xcodeでプロジェクトを開く**
```bash
open onMe.xcodeproj
```

3. **依存関係の確認**
- Swift Package Managerの依存関係は自動解決されます
- 外部APIキーの設定は不要（無料APIを使用）

4. **ビルド・実行**
- シミュレーターまたは実機を選択
- ⌘+R でビルド・実行

### テスト実行
```bash
# ユニットテスト
⌘+U

# UIテスト  
Product > Test (または ⌘+U でテストナビゲーターから選択)
```

### 開発時の注意点
- **為替レートAPI**: 開発時は無料版のため、リクエスト制限があります
- **ネットワーク**: シミュレーターでネットワーク機能をテストする場合は、インターネット接続が必要です
- **Core Data**: 初回起動時にデータベースが作成されます

## 📊 パフォーマンス

### 最適化項目
- **起動時間**: 1秒以下（為替レート取得は非同期）
- **メモリ使用量**: 100MB以下（通常使用時）
- **画像キャッシュ**: 効率的なメモリ・ディスクキャッシュ
- **データベース**: Core Dataの最適化クエリ
- **ネットワーク**: 為替レートの1時間キャッシュ

### 監視機能
- リアルタイムパフォーマンス監視
- メモリ使用量アラート
- 処理時間の計測・ログ出力
- ネットワーク通信の監視

## 🛡 セキュリティ

### データ保護
- **暗号化**: AES-256-GCMによるデータ暗号化
- **キーチェーン**: 暗号化キーの安全な保存
- **生体認証**: Face ID/Touch IDによるアクセス制御
- **ローカル処理**: 為替レート以外の全データ処理をデバイス内で完結

### プライバシー
- **最小限収集**: 機能に必要最小限の情報のみ使用
- **外部送信**: 為替レート取得のみ（個人データは送信しない）
- **透明性**: データ使用目的の明確な説明
- **ユーザー制御**: いつでもデータの削除・エクスポートが可能

### ネットワークセキュリティ
- **HTTPS通信**: 為替レートAPIとの通信は全てHTTPS
- **証明書ピニング**: API通信のセキュリティ強化
- **タイムアウト設定**: 適切なネットワークタイムアウト

## 🌍 国際化

### 対応言語
- **日本語**（デフォルト）
- **英語**

### 通貨フォーマット
- 各通貨に対応した適切な表示形式
- ロケール対応の数値フォーマット
- 通貨シンボルの正確な表示

## ♿ アクセシビリティ

### 対応機能
- **VoiceOver**: 全画面でのスクリーンリーダー対応
- **ダイナミックタイプ**: システムフォントサイズに連動
- **ハイコントラスト**: 色覚に配慮したカラーパレット
- **音声制御**: 音声コマンドでの操作
- **為替レート読み上げ**: 通貨変換情報の音声対応

## 📱 App Store 対応

### 準備済み項目
- App Store Review Guidelines準拠
- プライバシーラベル対応（ネットワーク使用の明記）
- セキュリティ要件クリア
- パフォーマンス基準達成
- 為替レートAPI利用規約遵守

## 🔄 更新履歴

### v1.1.0 (Latest)
- ✨ リアルタイム為替レート機能追加
- ✨ 10通貨対応
- ✨ 自動通貨変換表示
- 🔧 パフォーマンス改善
- 🐛 バグ修正

### v1.0.0
- 🎉 初回リリース
- 基本的な支出管理機能
- グループ管理
- 清算計算アルゴリズム
- レシートOCR機能

## 🤝 貢献

このプロジェクトへの貢献を歓迎します。

### 貢献方法
1. **Issue作成**: 機能提案・バグ報告
2. **Pull Request**: コード貢献
3. **ドキュメント**: 改善提案
4. **翻訳**: 多言語対応支援

### 開発ガイドライン
- Clean Architectureの原則に従う
- SwiftUIのベストプラクティスを適用
- 適切なテストカバレッジを維持
- アクセシビリティを考慮した実装

## 🔮 今後の予定

### 近日予定
- [ ] より多くの通貨対応（20通貨以上）
- [ ] 為替レート履歴表示
- [ ] 通貨変動アラート機能
- [ ] データ同期機能（iCloud）

### 長期計画
- [ ] Android版の開発
- [ ] Web版の提供
- [ ] 企業向け機能
- [ ] 詳細な分析・レポート機能

## 📄 ライセンス

このプロジェクトは[MIT License](LICENSE)の下で公開されています。

## 📞 サポート

- **バグ報告**: [GitHub Issues](https://github.com/your-username/onMe/issues)
- **機能要望**: [GitHub Issues](https://github.com/your-username/onMe/issues)  
- **質問**: [GitHub Discussions](https://github.com/your-username/onMe/discussions)
- **セキュリティ**: security@onme-app.com

## 🙏 謝辞

- [ExchangeRate-API](https://exchangerate-api.com/) - 為替レートAPI提供
- Swift/SwiftUIコミュニティの皆様
- テストにご協力いただいた全ての方々

---

<div align="center">

**onMe** - シンプルで安全な旅行支出管理  
*リアルタイム為替レート対応で、世界中どこでも安心*

[⬆ トップに戻る](#onme)

</div>